{
    "contents" : "library(\"ggmap\")\nlibrary(maptools)\nlibrary(maps)\nlibrary(dplyr)\nlibrary(stringr)\nlibrary(ggplot2)\nlibrary(gridExtra)\n#visualization part:\ncity_information<-function(city_sel){\nq1table6_2015<-read.csv('2015_q1_table6.csv',header=TRUE,stringsAsFactors=FALSE)\n\n# Graph on the map all the airline that departs from city1\n# load city1 data(just one city) into data frame\n#start_city<-\"New York City, NY (Metropolitan Area)\"\nstart_city<-city_sel\nstart<-gsub(\"\\\\s*\\\\([^\\\\)]+\\\\)\",\"\",as.character(start_city))\nll.start<-geocode(start)\nstar<-data.frame(start,ll.start)\n\n#load city2 data( all cities related to city1 into a data frame\n#visited_city<-filter(q1table6_2015,q1table6_2015$city1==\"New York City, NY (Metropolitan Area)\")\n#visited<-gsub(\"\\\\s*\\\\([^\\\\)]+\\\\)\",\"\",as.character(visited_city$city2))\nvisited<-c(\"Boston,MA\")\nll.visited<-geocode(visited)\nvisited.fare.table<-filter(q1table6_2015,q1table6_2015$city1==\"New York City, NY (Metropolitan Area)\")\nvisited.fare<-visited.fare.table$fare\ngeo<-data.frame(visited,ll.visited,visited.fare)\n\nnew<-data.frame(star,geo)\n\n#plot the state included us map first\n# them add points showing the longtitude and lattitude information of city 1\n# the add points of all city2\n# connect city 1 and city 2s with lines\nall_states <- map_data(\"state\")\np<-ggplot()\np<-p + geom_polygon(data=all_states, aes(x=long, y=lat, group = group),colour=\"white\", fill=\"grey10\")\np_city<-p+geom_point( data=geo, aes(x=lon, y=lat), color=\"red\",size=2)\np_withpoint<-p_city+geom_point( data=star, aes(x=lon, y=lat),color=\"blue\",size=5) + geom_segment(data=new,aes(x=lon,y=lat,xend=lon.1,yend=lat.1),color=visited.fare, arrow=arrow(length=unit(0.3,\"cm\")),show.legend = TRUE)\np_withtext<-p_withpoint+geom_text(aes(x=lon, y=lat,label = visited),data=geo,color=\"pink\",size=2.5)\nreturn(p_withtext)\n}\n\n#statistical analysis part:\n# For a given city in city1, like 'NYC', select all the cities that have flight from the\n# given city, store the data in 'citydataframe'\nstatistical_departp1<-function(stat_city_sel){\n  #cityname<-\"New York City, NY\"\n  cityname<-stat_city_sel\n  table6<-q1table6_2015\n  citydata<-table6 %>% filter(str_detect(city1, cityname))\n  citydataframe<-as.data.frame(citydata)\n  \n  # plot the graph of average fare versus destination cities (city2)\n  titlenames_1<-paste('The average fares of airlines from ',cityname,' to other cities')\n  p1<-ggplot(citydataframe, aes(city2, fare)) + \n    xlab('fare') + ylab('destination')  + ggtitle(titlenames_1) +\n    geom_bar(stat='identity', fill=\"#FF9999\", colour=\"black\") +coord_flip()\n  return(p1)\n}\n\nstatistical_departp2<-function(stat_city_sel){\n  #cityname<-\"New York City, NY\"\n  cityname<-stat_city_sel\n  table6<-q1table6_2015\n  citydata<-table6 %>% filter(str_detect(city1, cityname))\n  citydataframe<-as.data.frame(citydata)\n  \n  \n  #  plot the graph of average passenger versus destination cities (city2)\n  titlenames_2<-paste('The average passenger of airlines from ',cityname,' to other cities')\n  p2<-ggplot(citydataframe, aes(city2, passengers)) + \n    xlab('passengers') + ylab('destination')  + ggtitle(titlenames_2) +\n    geom_bar(stat='identity', fill=\"red\", colour=\"black\") +coord_flip()\n  return(p2)\n  \n}\n\nstatistical_departp3p4<-function(stat_city_sel){\n  #cityname<-\"New York City, NY\"\n  cityname<-stat_city_sel\n  table6<-q1table6_2015\n  citydata<-table6 %>% filter(str_detect(city1, cityname))\n  citydataframe<-as.data.frame(citydata)\n  \n  # draw the scatterplot of fare versus city distance for a given city1\n  p3<-ggplot(citydataframe,aes(nsmiles,fare)) + geom_point() + geom_smooth() \n  #the correlation between fare and distance\n  cor_fare_dis<-cor(citydataframe$nsmiles,citydataframe$fare)\n  \n  p4<-ggplot(citydataframe,aes(passengers,fare)) + geom_point() + geom_smooth()\n  cor_fare_pasger<-cor(citydataframe$passengers,citydataframe$fare)\n  grid.arrange(p3,p4,nrow=2)\n  return(grid.arrange(p3,p4,nrow=2))\n  #return(grid.arrange(p1,p2,p3,p4,nrow=2,ncol=2))\n}\n\nstatistical_depart_infor<-function(stat_city_sel1,stat_city_sel2){\n  #cityname<-\"New York City, NY\"\n  cityname1<-stat_city_sel1\n  cityname2<-stat_city_sel2\n  table6_wholeyear<-read.csv('2015_table6.csv',header=TRUE,stringsAsFactors=FALSE)\n  \n  \n  selec_data<-table6_wholeyear %>% filter(str_detect(city1, cityname1)) %>% \n    filter(str_detect(city2, cityname2)) \n  \n  \n  selectdataframe<-as.data.frame(selec_data)\n  \n  \n  ggplot(selectdataframe,aes(quarter,fare)) + geom_bar(stat='identity',fill=\"pink\", colour=\"yellow\",width = 0.7) + \n    coord_cartesian(ylim=c(350,400))+geom_line(size=3,colour=\"grey\") + ylab('average fare') +\n    ggtitle('quarterly airline average fare change in year 2015') \n}\n\n",
    "created" : 1480522233542.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2735659582",
    "id" : "82F5857",
    "lastKnownWriteTime" : 1480534065,
    "path" : "~/Desktop/computing/final/Code_essential.R",
    "project_path" : "Code_essential.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}